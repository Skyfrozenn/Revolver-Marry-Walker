<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Товары</title>
</head>

 
    <h1>Revolver Marry Walker</h1><br>
    <button onclick="window.history.back()">Назад</button><br><br>
    <a href="{{url_for('profile')}}">Вернуться в профиль</a><br><br>
     
    <a href="{{url_for('cart_user_card')}}">Корзина</a><br><br><br><br>
    <b>Категория - {{sub_category_obj.parent_categories.title}}</b><br><br>
    <b>Подкатегория - {{sub_category_obj.title}}</b><br>


    <hr>
    <br>

<body>


    {% for product in products %}
        <img class="photo" src="data:image/*;base64,{{ product.avatar }}" alt="Profile Picture" style="max-width: 300px; height: auto; display: block; margin-bottom: 20px;">
            <b>Название - {{product.title}}</b> <br><br>
            <b>Описание - {{product.description}}</b> <br><br>
            <b>Дата добавления - {{product.date_add}}</b> <br><br>
            <b>Цена - {{product.price}}р</b> <br><br>
            <b>Количество на складе - {{product.count}}</b> <br><br>

        {% set ns = namespace(count_cart = 0) %}
        {% for cart in user_cart %}
            {% if cart.product_id == product.id %}
                {% set ns.count_cart = cart.count %}
            {% endif %}
        {% endfor %}

         {% if ns.count_cart > 0 %}
            <div class="cart-controls">
                <form action="/add_product_cart" method="post">
                    <input type="hidden" name="csrf_token" value="{{csrf_token()}}">
                    <input type="hidden" name="page" value="{{page}}">
                    <input type="hidden" name="sub_category_id" value="{{sub_category_id}}">
                    <input type="hidden" name="_method" value="products">
                    <input type="hidden" name="product_id" value="{{product.id}}">
                    <input type="hidden" name="action" value="decrease">
                    <button type="submit">-</button>
                    </form>

                <span class="cart-count">Количество в корзине - {{ns.count_cart}}</span>

                {% if ns.count_cart < product.count %}
                <!-- Показываем + только если можно добавить -->
                    <form action="/add_product_cart" method="post">
                        <input type="hidden" name="csrf_token" value="{{csrf_token()}}">
                        <input type="hidden" name="sub_category_id" value="{{sub_category_id}}">
                        <input type="hidden" name="page" value="{{page}}">
                        <input type="hidden" name="_method" value="products">
                        <input type="hidden" name="product_id" value="{{product.id}}">
                        <input type="hidden" name="action" value="increase">
                        <button type="submit">+</button>
                    </form>
                {% endif %}
            </div>

            {% else %}
            <!-- Товара нет в корзине -->
                <form action="/add_product_cart" method="post">
                    <input type="hidden" name="csrf_token" value="{{csrf_token()}}">
                    <input type="hidden" name="page" value="{{page}}">
                    <input type="hidden" name="sub_category_id" value="{{sub_category_id}}">
                    <input type="hidden" name="_method" value="products">
                    <input type="hidden" name="product_id" value="{{product.id}}">
                    <input type="hidden" name="action" value="add">
                    <button type="submit">Добавить в корзину</button>
                </form>
            {% endif %}
            <hr>
    
    {% endfor %}
            <hr>

    {% if page > 1 %}
        <a href="{{url_for('wath_all_products', page = page - 1 , sub_category_id = sub_category_id)}}">Назад</a>
    {% endif %}
     
    <b>(Страница {{page}} из {{count_page}})</b>

    {% if page < count_page %}
        <a href="{{url_for('wath_all_products', page = page + 1 , sub_category_id = sub_category_id)}}">Вперед</a>
    {% endif %}

     

            

        



    
</body>




</html>